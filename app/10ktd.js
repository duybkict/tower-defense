(function(w,K){function L(a,c,h,e,f){e+=f*2;c+=f;var g=0,s=true,o=D[g++],n=Board.s2mp(o);E();var d=$("<b>").addClass("e"+a+" l"+(f||"0")).css({left:n.x-50-12+"px",top:n.y-9+"px"});a=enemies[a];var k={p:a.p,s:a.s*h,hp:a.hp*c,a:a.a+e},q=B(function(){slots.forEach(function(j){var p=d.css("top"),x=d.css("left");j&&j.eLoc(l,Board.p2s(x,p),{x:x,y:p})})},25),l={nextPoint:function(){if(t&&s){var j=D[g++],p;if(j){p=Board.diff(o,j)*k.s;currSlot=o;o=j;n=Board.s2mp(o);l.moveTo(n,currSlot.r,p)}else{t--;lifeEl.html(t);
t<=0&&Game.stop(false);d.remove();y(q)}}},moveTo:function(j,p,x){d.css({"-webkit-transform":"rotate("+p+"deg)","-moz-transform":"rotate("+p+"deg)"}).animate({top:j.y-9+"px",left:j.x-12+"px"},x,"linear",function(){l.nextPoint()})},hitFor:function(j){k.hp-=F(1,j-k.a);k.hp<0&&l.die()},die:function(){d.remove();s=false;y(q);AM(k.p*c);G=parseInt($(killEl).html());killEl.html(G+1);slots.forEach(function(j){j&&j.died(l)})}};u.push(q);b.append(d);l.nextPoint();return l}function M(a,c,h){SM(units[a].C);var e=
$("<i>").addClass("u"+a),f=null,g=null,s=null,o=null,n={eLoc:function(d,k,q){if(!f&&Board.diff(h,k)<=units[a].RA){f=d;g=B(function(){d.hitFor(units[a].D);n.fire(s,o)},units[a].R);u.push(g)}else if(f==d&&Board.diff(h,k)>units[a].RA)n.died(d);else if(f==d){s=q;o=k;n.rotate(Board.uangle(h,k))}},fire:function(d,k){var q=$('<p class="b'+a+'">'),l=Board.s2mp(h);q.css({top:l.y-21,left:l.x-3}).appendTo(b).animate({top:parseInt(d.y)-5+"px",left:parseInt(d.x)+15+"px"},Board.diff(h,k)/25+125,function(){q.remove()})},
died:function(d){if(d==f){f=null;y(g)}},rotate:function(d){e.css({"-webkit-transform":"rotate("+d+"deg)","-moz-transform":"rotate("+d+"deg)"})}};c.append(e);return n}var D=[{x:0,y:7,r:90},{x:3,y:7,r:0},{x:3,y:5,r:90},{x:8,y:5,r:180},{x:8,y:9,r:90},{x:14,y:9,r:0},{x:14,y:6,r:-90},{x:11,y:6,r:0},{x:11,y:2,r:90},{x:17,y:2,r:180},{x:17,y:7,r:90},{x:20,y:7,r:90}],t,r,C,G,z=Math,E=z.random,v=z.floor,F=z.max,H=z.abs,I=w.setTimeout,B=w.setInterval,y=w.clearInterval,J=w.clearTimeout,m=0,A=[],u=[];b=$("#b");
moneyEl=$("#mo b");lifeEl=$("#li b");killEl=$("#ki b");bSize=b.width();numLocations=273;slots=Array(numLocations);slot=K;i=0;pathArray=[147,148,149,150,129,108,109,110,111,112,113,134,155,176,197,198,199,200,201,202,203,182,161,140,139,138,137,116,95,74,53,54,55,56,57,58,59,80,101,122,143,164,165,166,167];toggleOn=function(){if($(this).find("i").length==0){$(this).append('<span class="u'+m+'"></span>');$(this).toggleClass("h")}};toggleOff=function(){$(this).find("span").remove();$(this).toggleClass("h")};
U=function(a,c,h,e,f,g){return{p:a,t:c,l:h,lm:g||1,a:f||0,sm:e||1}};AM=function(a){r+=a;$(moneyEl).html("$"+parseFloat(r).toFixed(2))};SM=function(a){r-=a;$(moneyEl).html("$"+parseFloat(r).toFixed(2))};levels=[{u:[U(1,0,0)],nu:20,r:500},{u:[U(1,1,0)],nu:12,r:850},{u:[U(1,2,0)],nu:7,r:850},{u:[U(1,3,0)],nu:1,r:2500},{u:[U(0.25,0,0),U(1,0,1)],nu:30,r:300},{u:[U(0.5,1,0),U(1,1,1)],nu:25,r:500},{u:[U(0.5,2,0),U(1,2,1)],nu:12,r:1100},{u:[U(0.5,3,0),U(1,3,1)],nu:4,r:900},{u:[U(0.25,0,1),U(1,0,2)],nu:10,
r:300},{u:[U(0.75,1,1),U(1,1,2)],nu:30,r:500},{u:[U(0.5,2,1),U(1,2,2)],nu:7,r:1100},{u:[U(0.5,3,1),U(1,3,2)],nu:2,r:900},{u:[U(0.5,0,2),U(1,0,3)],nu:15,r:300},{u:[U(0.3,1,2),U(1,1,3)],nu:12,r:500},{u:[U(0.1,2,2),U(1,2,3)],nu:5,r:1100},{u:[U(0.5,3,2),U(1,3,3)],nu:3,r:900},{u:[U(1,0,3)],nu:15,r:300},{u:[U(1,1,3)],nu:15,r:500},{u:[U(1,2,3)],nu:15,r:1100},{u:[U(1,3,3)],nu:1,r:900}];units=[{R:200,RA:3,D:5,C:5},{R:680,RA:2,D:25,C:10},{R:250,RA:4,D:15,C:20}];enemies=[{s:500,hp:35,p:0.5,a:0},{s:1325,hp:80,
p:0.75,a:3},{s:600,hp:140,p:1,a:1},{s:900,hp:1100,p:5,a:1}];Game={start:function(){t=20;r=25;C=0;i=-1;for(b.empty();i++<numLocations-1;){var a=$('<div id="'+i+'">').css({height:50,width:50,top:50*v(i/21),left:50*(i%21)}).click(function(){Game.click({t:$(this).data("uw")?"uw-slot":"slot",i:this.id,el:$(this)})});pathArray.indexOf(i)<0?a.hover(toggleOn,toggleOff):a.addClass("no").data("uw",true).append("<em>");b.append(a)}(function(){function c(){$("#c").text(C);unleashMob(h);f()}var h,e,f;f=function(){if(h=
levels[C++]){$("#n").text(30);e=I(c,3E4);A.push(e)}};f();var g=B(function(){$("#n").text(parseInt($("#n").text())-1)},1E3);u.push(g);$("#sk").click(function(){J(e);c();return false})})();$("#l .lu").click(function(){m=$(this).find("p")[0];m=parseInt(m.className.split("u")[1]);var c=$("#l .lu")[m];$("#l .lu").removeClass("on").addClass("off");$(c).addClass("on");$("#s1 p").css("width",units[m].D/200*100+"%");$("#s2 p").css("width",units[m].RA/6*100+"%");$("#s3 p").css("width",100/units[m].R*100+"%")}).end().find(".u0").parent().click()},
stop:function(a){for(var c=0;c<A.length;c++)J(A[c]);for(c=0;c<u.length;c++)y(u[c]);a?alert("WINNER"):alert("Game Over.")},click:function(a){$("#b #options").length==1&&$("#b #options").remove();if(a.t=="slot"){slot=slots[a.i];if(!slot&&r>=units[m].C){var c=a.el;slots[a.i]=M(m,c,Board.p2s(c.css("left"),c.css("top")))}else slot&&showOptions(a)}}};unleashMob=function(a){var c=a.nu;(function h(){if(c--){var e,f=E(),g;for(e=0;e<a.u.length;e++)if(f<a.u[e].p){g=a.u[e];break}g?L(g.t,g.lm,g.sm,g.a,g.l):console.error("Err");
e=I(h,a.r);A.push(e)}})()};Board={p2s:function(a,c){return{x:v(parseInt(a)/50),y:v(parseInt(c)/50)}},s2mp:function(a){a=Board.s2p(a);return{x:a.x+25,y:a.y+25}},s2p:function(a){return{x:a.x*50,y:a.y*50}},diff:function(a,c){return F(v(H(a.x-c.x)),v(H(a.y-c.y)))},uangle:function(a,c){var h=Math.atan((c.y-a.y)/(c.x-a.x))*(180/Math.PI);h+=a.x>c.x?270:90;return h}};Game.start()})(this);